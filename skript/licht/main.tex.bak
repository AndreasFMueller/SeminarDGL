%externalize tikz
\usetikzlibrary{external}
\tikzexternalize[prefix=licht/tikz/, figure name=plot]

%used for drawing n(r)-Area
\definecolor{lGray}{gray}{0.8}
\definecolor{llGray}{gray}{0.9}
\usepgfplotslibrary{fillbetween}

\usepackage{subcaption}
\usepackage{subfigure}
    
\chapter{Lichtbrechung in der Atmosph"are\label{chapter:thema}}
\lhead{Lichtbrechung in der Atmosph"are}
\begin{refsection}
\chapterauthor{Simon Schaefer und Tibor Schneider}

\printbibliography[heading=subbibliography]
\end{refsection}

%polar plot
\usepgfplotslibrary{polar}

\section{Einleitung}
Der Blick an den Nachthimmel fasziniert uns Menschen schon seit Jahrtausenden. "Ahnlich der Frage "uber das Leben nach dem Tod wurden damit ganze Religionen und Kulturen begr"undet beziehungsweise zugrunde gerichtet. 
"Uber die Jahrhunderte wuchs die Einsicht, wenn auch nicht stetig und leider auch nicht strikt monoton, dass eine genauere Vermessung des Nachthimmels, die Astrometrie, wenigstens physikalische Grundlagen zur Diskussion betragen kann. 
W"ahrend Galileo Galilei noch mit blossem Auge und einem besseren Flaschenboden den Nachhimmel beobachtete (TODO: QUELLE), nutzte T. Brahe bereits ein XXX Teleskop (TODO: QUELLE). 
Beide beobachteten die Bewegungen der Planeten unseres Sonnensystems und nahmen die Positionen entfernterer Sterne, Galaxien und anderen Objekten als sogenannte Fixsterne als konstant an. 
W"ahrend die Nasa und andere noch daran t"ufteln einen Menschen auf unseren n"achsten Nachbarplaneten zu bugsieren, sind unsere Blicke und v.a. unsere Neugier bereits Milliarden von Lichtjahren "uber unser Sonnensystem hinaus ins Weltall gerichtet. 
Die ehemaligen Fixsterne sind zu dynamischen Konstallationen erstaunlicher Ph"anomene geworden.
Neue Technologien der Sensorik erz"ahlen uns von der materiellen Zusammensetzung leuchtender Gaswolken. 
Gewaltige Pulsare werden zu Meilensteinen intergalaktischen Kartographie. 
Die Bewegung und die unfassbaren Distanzen ganzer Galaxien von unserem Heimatplaneten geben uns sogar die M"oglichkeit in der Zeit zur"uck zu blicken.
Die Gr"osse unseres Universums  erlaubt es sogar Annahmen "uber das Schicksal unseres eigenen Sonnensystems zu treffen, indem wir andere Systeme beobachten. 
Die extremen Distanzen zwischen uns und den beobachteten Objekten fordern eine hohe Pr"azision bei der Konstruktion der verwendeten Messinstrumente sowie ein tiefes Verst"andnis aller mo"glichen Effekte, die unseren Blick in die Tiefe des Weltalls beeinflussen. 
Angefangen bei simplen Regenwolken, "uber die Lichtverschmutzung unserer Zivilisation, zu optischen Effekten der Lichtbrechung in der Atmosph"are durch die Temperatur und Zusammensamensetzung, ja sogar Bewegung der Lufschichten bis hin zu relativistischen Effekten (TODO: QUELLE), die einen Lichtstrahl aus weiter Ferne so manipulieren k"onnen, dass uns dessen Ursprung an ganz anderem Ort erscheint, als er tats"achlich ist. 
Schon in der Primarschule lehr der Strahlensatz, dass schon kleine Messfehler bei der Auswertung eines Bildes hier auf der Erde, hochgerechnet auf die Weiten des Universums extreme Dimensionen annehmen. (TODO: HISTORISCHES BEISPIEL). 
In diesem Artikel m"ochten wir nun basierend auf Jean Kovalevsky und P. Kenneth Seidelmanns 6. Kapitel in Grundlagen der Astrometrie \cite{licht:astrometry} die scheinbare Verschiebung beobachteter Objekte und deren mathematischen Korrektur beschreiben. 

\section{Planares Modell} 
\begin{figure}
\centering
\begin{tikzpicture}
  \begin{axis}[xlabel=$x$, ylabel = $y$, axis lines=middle, height=5cm, width = 8cm,
  ymin=0, ymax=1.5, xmin=0, xmax=1, yticklabels={$y_0$, $y$, $y + dy$}, ytick =
  {0.2,0.5,0.7}, xtick={0.2}, xticklabel={\rlap{$x_0$}}]
    \draw[dashed] (axis cs:0,0.5) -- (axis cs:1,0.5);
    \draw[dashed] (axis cs:0,0.7) -- (axis cs:1,0.7);
    \draw[dashed] (axis cs:0,0.5) -- (axis cs:1,0.5);
    \draw[dashed] (axis cs:0.2,0) -- (axis cs:0.2,0.2);
    \draw[dashed] (axis cs:0,0.2) -- (axis cs:0.2,0.2);
    \filldraw (axis cs:0.2,0.2) circle (2pt) node[anchor=north east] {$A$};
    \draw (axis cs:0.2,0.2) -- (axis cs:0.6,0.7);
    \draw (axis cs:0.6,0.7) -- (axis cs:1,1);
    \draw (axis cs:0.52, 0.595) arc (210:270:0.6cm) node[anchor=north east, yshift =
    +0.44cm] {$\alpha$};
    \draw (axis cs:0.688,0.762) arc (19:90:0.6cm) node[anchor=west, yshift=+0.05cm,
    xshift=+0.2cm] {$\alpha + d\alpha$};  
    \draw[dashed](axis cs:0.6,0.4) -- (axis cs:0.6,1);
    \draw (axis cs:0.3, 0.6) node {$n$};
    \draw (axis cs:0.3, 0.8) node {$n + dn$};
  \end{axis}
\end{tikzpicture}
\caption{Skizze des planaren Modells}
\label{fig:13_1}
\end{figure}


Es wird von der Snell's Gleichung ausgegangen: $n_1 \sin \alpha_1 = n_2 \sin \alpha_2$.
Durch Einsetzen der Oberen Grafik ergibt sich:

\begin{equation} \label{eq:13_1}
  n \cdot \sin(\alpha) = n_0 \cdot \sin(\alpha_0) = \varepsilon
\end{equation}

Aus der Geometrie in der Abbildung \ref{fig:13_1} ist ersichtlich:
$$\frac{\cos \alpha}{\sin \alpha} = \frac{dy}{dx} = y'(x)$$
$$\Rightarrow y'(x)^2 = \frac{1 - \sin^2 \alpha}{\sin^2 \alpha} = \frac{1}{\sin^2 \alpha} - 1$$

Nun k"onnen wir das nach $sin^2(\alpha)$ aufl"osen, indem wir durch $y'(x)^2$ teilen. 
Da diese Ableitung m"oglicherweise $=0$ sein kann, muss dieser Fall separat behandelt werden (siehe Kapitel \ref{ch:spezialfall}). 
Von nun an gilt die Bedingung: $f'(x) \neq 0$.

\begin{equation} \label{eq:13_2}
\sin^2 (\alpha) = \frac{1}{y'(x)^2 + 1}
\end{equation}

Nun quadrieren wir die Gleichung \ref{eq:13_1}, setzen \ref{eq:13_2} ein und l"osen nach $y'(x)$ auf:

\begin{equation} \label{eq:13_3}
n^2 \cdot \frac{1}{y'(x)^2 + 1} = \varepsilon^2 = (n_0 \cdot \sin \alpha_0)^2
\end{equation}

\begin{equation} \label{eq:13_4}
\Rightarrow y'(x)^2 = \left( \frac{n}{\varepsilon} \right)^2 - 1
\end{equation}

Nun k"onnte man die Differentialgleichung nummerisch l"osen. 
Das problem ist aber, dass eine Differentialgleichung zweiter Ordnung vorliegt, jedoch in der Funktion die Anfangssteigung $y'(0)$ (in der Form von $\sin \alpha_0$) vorkommt. 
Dies wird in Kapitel \ref{ch:korrektur} genauer erkl"art.

\subsection{Korrektur der Differentialgleichung} \label{ch:korrektur}

Wie in der Gleichung \ref{eq:13_3} zu erkennen ist, ist der Anfangswinkel in der Gleichung vorhanden. 
Dieser ist von der Anfangssteigung abh"angig. 
Da jedoch die Differentialgleichung (aktuell) in der ersten Ordnung ist, wird die Gleichung \ref{eq:13_3} nach $x$ abgeleitet:

$$\frac{d}{dx} \left( \frac{n^2}{y'^2 + 1} \right) = \frac{2n}{y'^4 + 2y'^2 + 1} \cdot \left( n'_r(y'^2 + 1) - n y' y'' \right) = 0$$

Nun sind wir $\alpha_0$ losgeworden und haben die jetzt vorliegende Gleichung hat Ordnung 2. 
Nun k"onnen wir den Anfangswinkel $\alpha_0$ als Steigung in den Anfangsbedingungen definieren. 
Da der ganze Term gleich 0 ist, muss der Ausdruck in den Klammern gleich 0 sein:

$$n'y'^2 + n' - n y' y'' = 0$$
$$y''(x) = \frac{n'(y(x))}{n(y(x))} \cdot \left( y'(x) + \frac{1}{y'(x)} \right)$$

Aufgrund der Kettenregel $\frac{dn}{dx} = \frac{dn}{dy} \cdot \frac{dy}{dx}$ kann man die Differentialgleichung weiter vereinfachen:

\begin{equation} \label{eq:planar_DGL}
y''(x) = \frac{\frac{\partial n}{\partial y}}{n(y)} \cdot \left( y'(x)^2 + 1\right)
\end{equation}

\subsection{Verifikation}
Um zu "uberpr"ufen, ob unser Modell plausibel ist, setzen wir verschiedene Funktionen fur $n(y)$ ein. 

Wenn die Brechzahl konstant ist (das Heisst $n'(y) = 0$), dann sollte sich der Lichtstrahl nicht mehr brechen und auf einer Geraden weiterfahren. 
Wenn man nun $n'(y)=0$ in die Gleichung \ref{eq:planar_DGL} einsetzt, erhält man: 

$$y''(x) = 0$$

Auch aus unserer Gleichung ist also erkennbar, dass sich der Lichtstrahl bei konstantem $n$ nicht bricht.

Nun setzen wir die Function $n(y) = 1 + \mu e^{-\sigma y}$ und $\frac{dn}{dy} = -\sigma \mu e^{-\sigma y}$ ein.

\begin{equation} \label{eq:planar_DGL_n}
y''(x) = \frac{-\sigma}{\frac{1}{\mu e^{-\sigma y}} + 1} \cdot \left( y'(x)^2 + 1 \right)
\end{equation}

Der Lichtstrahl sollte sich immer in richtung des grösseren $n$ kr"ummen. 
Bei unserer Funktion bedeutet dies, er kr"ummt sich nach unten. 
Diese Differentialgleichung lässt sich nummerisch l"osen (siehe Abbildung \ref{fig:planares_modell1}).
Wie zu erwarten war, kr"ummen sich die Lichtstrahlen nach unten.
Je H"oher der Strahl ist, desto schw"acher kr"ummt er sich. 

\begin{figure}
\centering
\begin{tikzpicture}
  \begin{axis}[xlabel=$x$, ylabel=$y(x)$, axis lines=middle, height=5cm, width=5cm, ticks
  = none, legend pos = outer north east, legend style={draw=none}, ymin = 0, ymax = 10,
  xmin = 0, xmax = 10, colormap={traditionalpm3d}{color=(white) color=(lGray)}, %colorbar,
  view={0}{90}] 

  \addplot3[surf, domain=-10:10, y domain=0:20 , shader=flat, samples=61] {1 + 1 * exp(-y/2)};  
  \addlegendentry{$n(y)$}
  
  \addplot [mark = none, thick, draw=blue] coordinates{
        (0.00000,0.00000)(0.00008,0.00005)(0.00017,0.00010)(0.00025,0.00015)
        (0.00033,0.00020)(0.00075,0.00045)(0.00117,0.00070)(0.00159,0.00095)
        (0.00201,0.00121)(0.00410,0.00246)(0.00620,0.00371)(0.00829,0.00496)
        (0.01038,0.00622)(0.02085,0.01245)(0.03131,0.01866)(0.04178,0.02485)
        (0.05225,0.03100)(0.10458,0.06137)(0.15691,0.09107)(0.20924,0.12012)
        (0.26157,0.14852)(0.51157,0.27569)(0.76157,0.38962)(1.01157,0.49129)
        (1.26157,0.58151)(1.51157,0.66092)(1.76157,0.73009)(2.01157,0.78945)
        (2.26157,0.83938)(2.51157,0.88018)(2.76157,0.91208)(3.01157,0.93526)
        (3.26157,0.94986)(3.51157,0.95594)(3.76157,0.95354)(4.01157,0.94265)
        (4.26157,0.92322)(4.51157,0.89512)(4.76157,0.85822)(5.01157,0.81229)
        (5.26157,0.75706)(5.51157,0.69221)(5.76157,0.61731)(6.01157,0.53186)
        (6.26157,0.43525)(6.51157,0.32674)(6.76157,0.20546)(7.01157,0.07031)
        (7.26157,-0.08007)(7.51157,-0.24736)(7.76157,-0.43357)(8.01157,-0.64143)
        (8.26157,-0.87451)(8.51157,-1.13773)(8.76157,-1.43704)(9.01157,-1.78220)
        (9.26157,-2.18838)(9.40485,-2.45726)(9.54812,-2.76003)(9.69140,-3.10717)
        (9.83468,-3.51505)(9.87601,-3.64716)(9.91734,-3.78722)(9.95867,-3.93632)
        (10.00000,-4.09576)};
    \addlegendentry{$f'(0) = 0.6$}
    
    \addplot [mark = none, thick, draw=red] coordinates{
        (0.00000,0.00000)(0.00005,0.00005)(0.00010,0.00010)(0.00015,0.00015)
        (0.00020,0.00020)(0.00045,0.00045)(0.00070,0.00070)(0.00095,0.00095)
        (0.00121,0.00121)(0.00246,0.00246)(0.00372,0.00372)(0.00497,0.00497)
        (0.00623,0.00622)(0.01251,0.01248)(0.01879,0.01872)(0.02507,0.02495)
        (0.03135,0.03117)(0.06275,0.06202)(0.09415,0.09252)(0.12554,0.12267)
        (0.15694,0.15248)(0.31394,0.29668)(0.47093,0.43331)(0.62792,0.56302)
        (0.78491,0.68641)(1.03491,0.87100)(1.28491,1.04240)(1.53491,1.20197)
        (1.78491,1.35087)(2.03491,1.49003)(2.28491,1.62024)(2.53491,1.74218)
        (2.78491,1.85645)(3.03491,1.96356)(3.28491,2.06393)(3.53491,2.15797)
        (3.78491,2.24601)(4.03491,2.32835)(4.28491,2.40526)(4.53491,2.47697)
        (4.78491,2.54370)(5.03491,2.60563)(5.28491,2.66293)(5.53491,2.71574)
        (5.78491,2.76420)(6.03491,2.80844)(6.28491,2.84854)(6.53491,2.88461)
        (6.78491,2.91672)(7.03491,2.94495)(7.28491,2.96936)(7.53491,2.98999)
        (7.78491,3.00690)(8.03491,3.02011)(8.28491,3.02966)(8.53491,3.03557)
        (8.78491,3.03784)(9.03491,3.03648)(9.28491,3.03149)(9.53491,3.02286)
        (9.78491,3.01056)(9.83869,3.00744)(9.89246,3.00414)(9.94623,3.00068)
        (10.00000,2.99704)};
    \addlegendentry{$f'(0) = 1$}
    
    \addplot [mark = none, thick, draw=green] coordinates{
       (0.00000,0.00000)(0.00004,0.00005)(0.00007,0.00010)(0.00011,0.00015)
       (0.00014,0.00020)(0.00032,0.00045)(0.00050,0.00070)(0.00068,0.00095)
       (0.00086,0.00121)(0.00176,0.00246)(0.00266,0.00372)(0.00355,0.00497)
       (0.00445,0.00622)(0.00894,0.01249)(0.01342,0.01874)(0.01791,0.02498)
       (0.02239,0.03121)(0.04482,0.06220)(0.06725,0.09292)(0.08967,0.12337)
       (0.11210,0.15358)(0.22424,0.30091)(0.33638,0.44255)(0.44852,0.57900)
       (0.56065,0.71072)(0.81065,0.98925)(1.06065,1.24961)(1.31065,1.49459)
       (1.56065,1.72638)(1.81065,1.94668)(2.06065,2.15691)(2.31065,2.35825)
       (2.56065,2.55168)(2.81065,2.73803)(3.06065,2.91802)(3.31065,3.09225)
       (3.56065,3.26128)(3.81065,3.42555)(4.06065,3.58549)(4.31065,3.74145)
       (4.56065,3.89376)(4.81065,4.04271)(5.06065,4.18856)(5.31065,4.33154)
       (5.56065,4.47186)(5.81065,4.60971)(6.06065,4.74527)(6.31065,4.87869)
       (6.56065,5.01012)(6.81065,5.13969)(7.06065,5.26753)(7.31065,5.39374)
       (7.56065,5.51843)(7.81065,5.64170)(8.06065,5.76362)(8.31065,5.88429)
       (8.56065,6.00378)(8.81065,6.12216)(9.06065,6.23950)(9.31065,6.35585)
       (9.56065,6.47128)(9.67049,6.52171)(9.78033,6.57198)(9.89016,6.62209)
       (10.00000,6.67204) };
    \addlegendentry{$f'(0) = 1.4$}
    
    \addplot [mark = none, thick, draw=black] coordinates{
       (0.00000,0.00000)(0.00003,0.00005)(0.00006,0.00010)(0.00008,0.00015)
       (0.00011,0.00020)(0.00025,0.00045)(0.00039,0.00070)(0.00053,0.00095)
       (0.00067,0.00121)(0.00137,0.00246)(0.00207,0.00372)(0.00276,0.00497)
       (0.00346,0.00622)(0.00695,0.01249)(0.01044,0.01875)(0.01393,0.02499)
       (0.01742,0.03123)(0.03486,0.06227)(0.05230,0.09308)(0.06975,0.12366)
       (0.08719,0.15403)(0.17441,0.30265)(0.26163,0.44635)(0.34885,0.58556)
       (0.43606,0.72069)(0.64497,1.02972)(0.85387,1.32103)(1.06278,1.59761)
       (1.27168,1.86179)(1.52168,2.16416)(1.77168,2.45381)(2.02168,2.73271)
       (2.27168,3.00247)(2.52168,3.26436)(2.77168,3.51946)(3.02168,3.76864)
       (3.27168,4.01267)(3.52168,4.25218)(3.77168,4.48771)(4.02168,4.71973)
       (4.27168,4.94865)(4.52168,5.17481)(4.77168,5.39853)(5.02168,5.62008)
       (5.27168,5.83969)(5.52168,6.05756)(5.77168,6.27389)(6.02168,6.48883)
       (6.27168,6.70254)(6.52168,6.91513)(6.77168,7.12672)(7.02168,7.33741)
       (7.27168,7.54730)(7.52168,7.75647)(7.77168,7.96499)(8.02168,8.17292)
       (8.27168,8.38032)(8.52168,8.58724)(8.77168,8.79374)(9.02168,8.99986)
       (9.27168,9.20562)(9.45376,9.35529)(9.63584,9.50480)(9.81792,9.65416)
       (10.00000,9.80340) };
    \addlegendentry{$f'(0) = 1.8$}
    
  
  \end{axis}
\end{tikzpicture}
\caption{Nummerische L"osung der Differentialgleichung (\ref{eq:planar_DGL_n})}
\label{fig:planares_modell1}
\end{figure}

TODO: weitere Simiulationen von verschiedenen Brechzahlen

\subsection{Spezialfall: $y'(x) = 0$} \label{ch:spezialfall}

In diesem Modell ist die Brechzahl $n$ nur von $y$ abhängig. 
Falls die Funktion nun die Steigung $f'(x) = 0$ hat, dann "andert sich die Brechzahl in Richtung des Lichtstrahls nicht mehr.
Dies w"urde bedeuten, dass sich der Lichtstrahl nicht weiter kr"ummt. 

In der Realit"at gibt es in der Luft immer Unregelm"assigkeiten. 
Betrachten wir das Beispiel der Abbildung \ref{fig:planares_modell1}. 
Falls der Lichtstrahl waagerecht ist, kann er aufgrund der Unregelm"assigkeiten entweder nach oben oder unten gebrochen werden. 
Wenn er nach oben gebrochen wird, so kr"ummt er sich sofort wieder nach unten. 
Und wenn er sich nach unten bricht, dann kr"ummt er sich weiter nach unten. 
In der Realit"at ist dieser Spezialfall also nicht problematisch. 

In unserem Modell jedoch wird bei der Herleitung durch $y'(x)$ geteilt.
Die Gleichung \ref{eq:planar_DGL} gilt also nicht f"ur diesen Spezialfall. 
Duch den Quantisierungsfehler beim nummerischen L"osen wird jedoch dieser Spezialfall nie erreicht.
Wie in der Abbildung \ref{fig:planares_modell1} an der blauen Kurve mit $f'(0) = 0.6$ zu erkennen ist, kr"ummt sich der Lichtstrahl einfach weiter. 


\section{Sph"arisches Modell}

Wir beginnen erneut mit Snell's Gleichung, welche wir auf unser Sph"arischen Modells (Abbildung \ref{fig:13_3}) angepasst wurde: 

$$n \cdot \sin \beta = (n + dn) \cdot \sin(\alpha + d\alpha)$$

Im Dreieck $OMN$ l"asst sich mit dem Sinussatz folgende Beziehung herleiten:

$$r \sin\alpha = (r + dr) \cdot \sin\beta$$

Multipliziert man nun die beiden Gleichungen, erh"alt man:

\begin{equation} \label{eq:sphere_base}
n r \sin \alpha = (n + dn)(r + dr) \sin (\alpha + d\alpha) = n_0 r_0 \sin \alpha_0
\end{equation}

Wie beim Planaren Modell ist dieses Produkt konstant. 
Wir suchen eine Funktion $r(\varphi))$, welche den Weg eines Lichtstrahls beschreibt, der am Punkt $A$ mit Anfangswinkel $\alpha_0$ startet (oder endet). 

Aus dem Dreieck $MNP$ kann folgende Beziehung hergeleitet werden:

$$\tan \alpha =  \frac{\overline{NP}}{\overline{MP}} = \frac{r \cdot d\varphi}{dr} = \frac{r}{\frac{dr}{d\varphi}} = \frac{r}{r'}$$

Wir quadrieren die diese Gleichung und l"osen nach $\sin^2(\beta)$ auf:

$$\tan^2 \alpha = \frac{\sin^2\alpha}{\cos^2\alpha} = \frac{\sin^2\alpha}{1-\sin^2\alpha} = \frac{1}{\frac{1}{\sin^2\alpha}-1} \left( \frac{r(\varphi)}{r'(\varphi)} \right)^2$$

\begin{equation} \label{eq:sphere_sine}
\Rightarrow \sin^2\alpha = \frac{1}{\left( \frac{r'(\varphi)}{r(\varphi)} \right)^2 +1}
\end{equation}

\begin{figure} 
\centering
\begin{tikzpicture}
  %radial lines
  \draw (0,0) node[above]{$O$} 
        -- ++(0:10cm)
        (0,0) -- ++(15:10cm)
        (0,0) -- ++(22.5:10cm);
  %Radius r0, r, r + dr      
  \draw ([shift=(-5:6cm)]0,0) arc (-5:27.5:6cm) node [above] {$r_0$}
        ([shift=(-4:8cm)]0,0) arc (-4:27.5:8cm) node [above] {$r$}
        ([shift=(-3.8:9cm)]0,0) arc (-3.8:27.5:9cm) node [above, xshift=-0.2cm] {$r +
        dr$};
  %path of the light
  \draw [thick] (0:6cm) node [above left]{A}
        -- (15:8cm) node [above left, yshift=-0.1cm] {$M$}
        -- (22.5:9cm) node [below right, yshift=0.1cm]{$N$}
        -- (28:9.5cm);
  \draw (22.5:8cm) node [above left, yshift=-0.1cm] {$H$};
  \draw (15:9cm) node[below right] {$P$};
  %angles
  \draw ([shift=(-157.5:0.8cm)]22.5:9cm) arc (-157.5:-113.2:0.8cm) node [above,
          yshift=0.1cm]{$\beta$}
        ([shift=(15:0.8cm)]15:8cm) arc (15:66.8:0.8cm) node [below,
          yshift = -0.15cm, xshift=0.1cm]{$\alpha$}
        ([shift=(22.5:0.6cm)]22.5:9cm) arc (22.5:85.9:0.6cm) node
          [xshift=0.6cm, yshift=0.2cm]{$\alpha+d\alpha$}
        ([shift=(0:0.8cm)]0:6cm) arc (0:50.2:0.8cm) node [below,
          yshift=-0.14cm]{$\alpha_0$}
        ([shift=(0:2.5cm)]0,0) arc (0:15:2.5cm) node [below left,
          yshift=-0.15cm]{$\varphi$}
        ([shift=(15:4.5cm)]0,0) arc (15:22.5:4.5cm) node [below left,
          yshift=-0.12cm]{$d\varphi$};
  %refraction rates
  \draw (10:6cm) node[fill=white] {$n_0$}
        (10:8cm) node[fill=white] {$n$}
        (10:9cm) node[fill=white] {$n + dn$};
        
\end{tikzpicture}
\caption{Skizze des Sph"arischen Modells}
\label{fig:13_3}
\end{figure}

W"ahrend diesen Umformungen wurde durch $r'(\varphi)$ geteilt. 
In den folgenden Gleichungen sei Vorausgesetzt, dass $r'(\varphi) \neq 0$. 
Dieser Spezialfall wird im Kapitel \ref{ch:spezialfall_2} behandelt. 

F"ur sehr kleine $d\varphi$ ist $\alpha = \beta$. 
Somit k"onnen wir die Gleichung \ref{eq:sphere_base} quadrieren und \ref{eq:sphere_sine} einsetzen.

$$\frac{(n \cdot r(\varphi))^2}{\left( \frac{r'(\varphi)}{r(\varphi)} \right)^2 +1} = (r_0 n_0 \sin \alpha_0)^2$$

Diese Gleichung ist eine Differentialgleichung erster Ordnung. 
Jedoch ist erneut der Term $sin^2(\alpha_0)$ vorhanden, welcher von $r'(\varphi_0)$ abhängt. 
Damit die DGL auch korrekte Anfangsbedingungen erhält, leiten wir die Gleichung nach $\varphi$ ab und erhalten:

$$\frac{d}{d\varphi}\left(\frac{(n r)^2}{\left(\frac{r'}{r}\right)^2 + 1}\right) =  \frac{2 r^2 n r' n'_r}{\frac{r'^2}{r^2}+1}+\frac{2 r n^2 r'}{\frac{r'^2}{r^2}+1}-\frac{r^2 n^2 \left(\frac{2 r' r''}{r^2}-\frac{2 r'^3}{r^3}\right)}{\left(\frac{r'^2}{r^2}+1\right)^2}$$

$$\frac{2n r' r}{\frac{r'^2}{r^2}+1} \cdot \left( n'_r + n - \frac{n r r'' - n r'^2}{r'^2 + r^2} \right) = 0$$

\begin{equation} \label{eq:sphere_origin}
\Rightarrow n'_r + n - \frac{n r r'' - n r'^2}{r'^2 + r^2} = 0
\end{equation}

$$\Rightarrow n'_r r'^2  + n'_r r^2 + n r'^2 + nr^2 = n r r'' - n r'^2$$

$$\Rightarrow n'_r r'^2 + n'_r r^2 + 2 n r'^2 + n r^2 = n r r''$$

\begin{equation} \label{eq:sphere_allg}
\Rightarrow r'' = \frac{n'_r r'^2 + n'_r r^2 + 2 n r'^2 + n r^2}{n r}
\end{equation}

Anmerkung: Bei dieser Gleichung gilt: $n'_r = \frac{\partial n}{\partial r}$. 

\subsection{Verifikation}
Wie zuvor beim planaren Modell setzen wir verschiedene Funtionen f"ur $n(r)$ ein, und beurteilen die Resultate. 
Als erstes untersuchen wir die Funktion $n(r) = 1, n'(r) = 0$. 
Bei diesem Beispiel hat das Material "uberall dieselbe Brechzahl.
Die Nummerischen L"osungen sollten alle (bez"uglich den karteischen Koordinaten) linear ansteigen und sich nicht kr"ummen. 

TODO: Gleichung mit exponentieller Approximation der Athmosph"are.


\begin{figure}[H]
\centering
\begin{minipage}{0.45\textwidth}
\centering
\begin{tikzpicture}
  \begin{axis} [
    axis lines=none, 
    width=6cm, 
    height=6cm,
    ticks = none, 
    legend pos = outer north east, 
    legend style={draw=none}, 
    ymin = 0,
    ymax = 6,
    xmin = -3, 
    xmax = 3, 
  ]
    %f'(0)=1
    \addplot [mark = none, thick, color=red] coordinates {
      (0.00000,1.00000)(-0.01703,1.01703)(-0.03467,1.03467)(-0.05294,1.05294)(-0.07191,1.07191)(-0.09252,1.09252)(-0.11401,1.11401)(-0.13644,1.13644)(-0.15989,1.15989)(-0.18445,1.18445)(-0.21021,1.21021)(-0.23729,1.23729)(-0.26581,1.26581)(-0.29589,1.29590)(-0.32770,1.32771)(-0.36141,1.36141)(-0.39722,1.39722)(-0.43534,1.43534)(-0.47605,1.47605)(-0.51964,1.51964)(-0.56645,1.56645)(-0.61690,1.61690)(-0.67144,1.67145)(-0.73066,1.73066)(-0.79520,1.79520)(-0.86588,1.86589)(-0.94365,1.94366)(-1.02970,2.02970)(-1.12549,2.12549)(-1.23286,2.23287)(-1.35406,2.35407)(-1.49207,2.49207)(-1.65081,2.65082)(-1.83549,2.83555)(-2.05283,3.05284)(-2.31283,3.31280)(-2.62991,3.62995)(-2.92055,3.92067)(-3.26854,4.26856)
    };
    %f'(0) = 0.5
    \addplot [mark = none, thick, color=blue] coordinates {
      (0.00000,1.00000)(-0.01689,1.00844)(-0.03408,1.01704)(-0.05158,1.02579)(-0.06941,1.03471)(-0.09670,1.04835)(-0.12486,1.06243)(-0.15395,1.07697)(-0.18407,1.09203)(-0.21530,1.10765)(-0.24776,1.12388)(-0.28157,1.14078)(-0.31684,1.15842)(-0.35374,1.17687)(-0.39241,1.19621)(-0.43305,1.21652)(-0.47586,1.23793)(-0.52108,1.26054)(-0.56898,1.28449)(-0.61987,1.30993)(-0.67411,1.33706)(-0.73213,1.36607)(-0.79440,1.39720)(-0.86150,1.43075)(-0.93410,1.46705)(-1.01303,1.50652)(-1.09925,1.54963)(-1.19395,1.59698)(-1.29858,1.64929)(-1.41496,1.70750)(-1.54531,1.77267)(-1.69253,1.84627)(-1.86039,1.93020)(-2.05385,2.02698)(-2.27927,2.13965)(-2.54589,2.27292)(-2.86683,2.43344)(-3.17156,2.58589)
    };
    %draw Earth
    \addplot [domain=-1:1, mark=none, black, samples=101, name path=earth, thick] {sqrt(1 - x^2)};
  \end{axis} 
\end{tikzpicture}
\captionof{figure}{L"osung des Sph"arischen Modells mit $n(r) = 1$}
\label{fig:sphaerisches_modell1}
\end{minipage}
\quad
\begin{minipage}{0.4\textwidth}
\centering
\begin{tikzpicture}
  \begin{axis} [
    axis lines=none, 
    width=6cm, 
    height=6cm,
    ticks = none, 
    legend pos = outer north east, 
    legend style={draw=none}, 
    ymin = 0,
    ymax = 6,
    xmin = -3, 
    xmax = 3, 
    zmin = 1,
    zmax = 2,
    %colorbar, 
    colormap={traditionalpm3d}{color=(white) color=(llGray) color=(lGray) color=(lGray)},
    view={0}{90}
  ]  
    \addplot3[surf, domain=-4:4, y domain=0:4, shader=flat, samples=61] {1 + 1 * exp(-(sqrt(x^2+y^2)-1)/2)};  
    %f'(0)=0,2
    \addplot [mark = none, thick, color=blue] coordinates {
      (0.00000,1.00000)(-0.01332,1.00264)(-0.02671,1.00523)(-0.04019,1.00778)(-0.05374,1.01028)(-0.09766,1.01802)(-0.14254,1.02531)(-0.18851,1.03217)(-0.23567,1.03858)(-0.28418,1.04453)(-0.33419,1.05001)(-0.38587,1.05501)(-0.43940,1.05950)(-0.49500,1.06345)(-0.55289,1.06684)(-0.61334,1.06963)(-0.67664,1.07177)(-0.74314,1.07321)(-0.81322,1.07389)(-0.88734,1.07372)(-0.96600,1.07263)(-1.04982,1.07052)(-1.13952,1.06724)(-1.23592,1.06265)(-1.34006,1.05657)(-1.45317,1.04879)(-1.57672,1.03902)(-1.71256,1.02692)(-1.86302,1.01211)(-2.03105,0.99406)(-2.22032,0.97204)(-2.43583,0.94521)(-2.68435,0.91244)(-2.97519,0.87217)(-3.32034,0.82190)(-3.73947,0.75864)(-4.26247,0.67763)(-4.66896,0.61339)(-5.15258,0.53572)(-5.74058,0.44042)(-6.47383,0.32098)(-7.07070,0.22331)(-7.78451,0.10590)(-8.65695,-0.03780)(-9.75048,-0.21781)(-10.64136,-0.36457)(-11.70941,-0.54087)(-13.01771,-0.75678)(-14.66075,-1.02765)(-16.00049,-1.24854)(-17.60807,-1.51390)(-19.57873,-1.83911)(-22.05519,-2.24749)(-24.04608,-2.57581)(-26.42972,-2.96917)(-29.34303,-3.44988)(-32.99002,-4.05137)(-34.44359,-4.29116)(-36.03173,-4.55315)(-37.77414,-4.84060)(-39.69468,-5.15743)
    };
    %f'(0)=0.5
    \addplot [mark = none, thick, color=red] coordinates {
      (0.00000,1.00000)(-0.02287,1.01133)(-0.04628,1.02273)(-0.07026,1.03420)(-0.09484,1.04575)(-0.13129,1.06249)(-0.16915,1.07944)(-0.20856,1.09662)(-0.24964,1.11404)(-0.29253,1.13176)(-0.33741,1.14978)(-0.38445,1.16816)(-0.43386,1.18693)(-0.48586,1.20614)(-0.54073,1.22583)(-0.59876,1.24607)(-0.66027,1.26690)(-0.72567,1.28841)(-0.79538,1.31068)(-0.86993,1.33379)(-0.94992,1.35785)(-1.03605,1.38301)(-1.12913,1.40939)(-1.23016,1.43719)(-1.34033,1.46661)(-1.46106,1.49793)(-1.59408,1.53143)(-1.74156,1.56753)(-1.90621,1.60674)(-2.09152,1.64973)(-2.30177,1.69721)(-2.54287,1.75035)(-2.82274,1.81070)(-3.15233,1.88043)(-3.54591,1.96187)(-4.02657,2.05985)(-4.62950,2.18150)(-5.10124,2.27585)(-5.66443,2.38767)(-6.35138,2.52357)
    };
    %f'(0) = 1
    \addplot [mark = none, thick, color=green] coordinates {
      (0.00000,1.00000)(-0.02159,1.02144)(-0.04413,1.04355)(-0.06769,1.06635)(-0.09234,1.08990)(-0.11988,1.11587)(-0.14885,1.14283)(-0.17938,1.17085)(-0.21158,1.20002)(-0.24561,1.23044)(-0.28162,1.26222)(-0.31980,1.29548)(-0.36035,1.33036)(-0.40350,1.36702)(-0.44952,1.40562)(-0.49869,1.44638)(-0.55136,1.48951)(-0.60791,1.53528)(-0.66881,1.58400)(-0.73457,1.63602)(-0.80580,1.69175)(-0.88324,1.75168)(-0.96772,1.81638)(-1.06026,1.88654)(-1.16211,1.96301)(-1.27477,2.04682)(-1.40005,2.13916)(-1.54024,2.24163)(-1.69827,2.35624)(-1.87786,2.48554)(-2.08370,2.63268)(-2.32226,2.80216)(-2.60238,3.00014)(-2.93643,3.23523)(-3.34070,3.51823)(-3.84233,3.86838)(-4.48359,4.31531)(-4.95937,4.64639)(-5.52919,5.04235)(-6.22631,5.52657)(-7.10070,6.13397)(-7.94788,6.72246)(-8.99750,7.45079)(-10.34128,8.38345)(-12.12876,9.62479)
    };   
    %f'(0) = 1.5
    \addplot [mark = none, thick, color=black] coordinates {
      (0.00000,1.00000)(-0.01361,1.02708)(-0.02797,1.05537)(-0.04315,1.08496)(-0.05920,1.11595)(-0.07620,1.14845)(-0.09421,1.18258)(-0.11334,1.21846)(-0.13366,1.25625)(-0.15530,1.29610)(-0.17836,1.33821)(-0.20298,1.38278)(-0.22931,1.43004)(-0.25752,1.48025)(-0.28781,1.53371)(-0.32040,1.59077)(-0.35553,1.65182)(-0.39350,1.71730)(-0.43465,1.78774)(-0.47937,1.86375)(-0.52812,1.94605)(-0.58146,2.03548)(-0.64001,2.13305)(-0.70457,2.23995)(-0.77608,2.35768)(-0.85569,2.48804)(-0.94482,2.63321)(-1.04524,2.79599)(-1.15925,2.97998)(-1.28981,3.18983)(-1.44064,3.43132)(-1.61699,3.71275)(-1.82607,4.04553)
    };        
    %draw Earth
    \addplot [domain=-1:1, mark=none, black, samples=101, name path=earth, thick] {sqrt(1 - x^2)};
  \end{axis}   
\end{tikzpicture}
\captionof{figure}{Nummerische L"osung des Sph"arischen Modells mit der exponentiellen Approximation (Gleichung: \ref{eq:sphere_dgl_approx})}
\label{fig:sphaerisches_modell2}
\end{minipage}
\end{figure}

\subsection{Spezialfall: geschlossener Kreis}
Beim betrachten der Resultate f"allt auf, dass es m"oglicherweise eine Kombination aus Anfangsbedingungen und der Brechzahl das Licht in einem Kreis um den Planeten bricht. 
Um diese Bedingungen zu finden, starten wir mit der Gleichung \ref{eq:sphere_origin}:

$$\Rightarrow n'_r + n - \frac{n r r'' - n r'^2}{r'^2 + r^2} = 0$$

Bei diesem Spezialfall ist $r''(\varphi) = 0$, $r'(\varphi) = 0$. 
Setzen wir nun diese Bedingungen in die Gleichung ein, erhalten wir:

$$n'_r + n = 0 \quad \Rightarrow \quad n'_r(r) = -n(r)$$

Dies ist nun ebenfalls eine Differentialgleichung, welche die L"osung $n(r) = C \cdot e^{-r}$ hat.
Alle diese L"osungen haben die Eigenschaft, dass man bei dieser Verteilung der Brechzahl ein waagerechter Lichtstrahl auf jeder H"ohe in einen geschlossenen Kreis gebrochen wird.
Da diese L"osung die Bedingung $n(r) \geq 1$ jedoch nicht erf"ullt, gibt es keine m"ogliche Verteilung der Brechzahlen, bei der auf jeder H"ohe der waagrechte Lichtstrahl zu einem Kreis wird. 
Jedoch ist es m"oglich, dass diese Bedingung auf genau einer H"ohe zutrifft. 
Wir untersuchen wieder die Funktion $n(r) = 1 + \mu \cdot e^{-\sigma (r-r_0)}$, $n'(r) = -\mu \sigma \cdot e^{-\sigma (r-r_0)}$.

$$\mu \sigma \cdot e^{-\sigma (r-r_0)} = 1 + \mu \cdot e^{-\sigma (r-r_0)} \quad \Rightarrow \quad \mu \cdot e^{-\sigma (r-r_0)} \cdot (\sigma - 1) = 1$$

$$\mu = \frac{e^{\sigma (r-r_0)}}{\sigma - 1}$$

Wenn wir $r = r_0$ und $\sigma = 2$ festhalten, ergibt sich f"ur $\mu = 1$. 
Auch die Simulation best"atigt, dass in diesem Fall das Licht in einem Kreis gebrochen wird.
Jedoch ist eine solch extreme Athmosph"are nicht realistisch. 
Es braucht also ein anderes Modell, mit dem man diesen Effekt erzeugen kann.

Die Brechzahl der Luft ist nicht nur vom Druck abh"angig, sondern auch von der Luftf"auchtigkeit. 
dazu wird folgende Approximation verwendet:

$$n(r) = \left\{ \begin{array}{ll} 1 + \mu \cdot (r_0 - r)^2 & \text{wenn } r < r_0 \\ 1 & \text{sonst} \end{array} \right. \quad n'_r(r) = \left\{ \begin{array}{ll} 2\mu \cdot (r - r_0) & \text{wenn } r < r_0 \\ 0 & \text{sonst} \end{array} \right.$$

Nun l"osen wir die obere Bedingung $-n'_r = n $, wenn $r < r_0$:

$$2\mu \cdot (r_0 - r) = 1 + \mu(r_0 - r)^2$$

Wenn wir nun f"ur $(r_0 - r) = 1$ einsetzen, erhalten wir $\mu = 1$. 
Bei der Simulation mit diesen Bedingungen ist ersichtlich, dass in einen Kreis gebrochen wird. 

\begin{figure}
  \centering
  \begin{minipage}{0.48\textwidth}
    \centering

    \begin{tikzpicture}
      \begin{axis} [
        axis lines=none, 
        width=6cm, 
        height=6cm,
        ticks = none, 
        xmin = -2,
        xmax = 2,
        ymin = -2,
        ymax = 2,
        zmin = 1,
        zmax = 3,
        axis equal,
        colormap={traditionalpm3d}{color=(white) color=(lGray) color=(lGray) color=(lGray) color=(lGray) color=(lGray)},
        %colorbar,
        view={0}{90}
      ]
        \addplot3[surf, domain=-2:2, y domain=-2:2, shader=flat, samples=61] {1 + 1 * exp(-(sqrt(x^2+y^2)-1)*2)};  
        \addplot[mark = none, thick, draw=red] coordinates {
          (0.00000,1.00000)(-0.15643,0.98769)(-0.30902,0.95106)(-0.45399,0.89101)(-0.58779,0.80902)(-0.70711,0.70711)(-0.80902,0.58779)(-0.89101,0.45399)(-0.95106,0.30902)(-0.98769,0.15643)(-1.00000,0.00000)(-0.98769,-0.15643)(-0.95106,-0.30902)(-0.89101,-0.45399)(-0.80902,-0.58779)(-0.70711,-0.70711)(-0.58779,-0.80902)(-0.45399,-0.89101)(-0.30902,-0.95106)(-0.15643,-0.98769)(-0.00000,-1.00000)(0.15643,-0.98769)(0.30902,-0.95106)(0.45399,-0.89101)(0.58779,-0.80902)(0.70711,-0.70711)(0.80902,-0.58779)(0.89101,-0.45399)(0.95106,-0.30902)(0.98769,-0.15643)(1.00000,-0.00000)(0.98769,0.15643)(0.95106,0.30902)(0.89101,0.45399)(0.80902,0.58779)(0.70711,0.70711)(0.58779,0.80902)(0.45399,0.89101)(0.30902,0.95106)(0.15643,0.98769)(0.00000,1.00000)
        };
    
      \end{axis}
    \end{tikzpicture}    
    \captionof{figure}{Nummersiche L"osung mit $n(r) = 1 + \mu e^{-\sigma (r - r_0)}$ mit $r(0) = r_0$, $r'(0) = 0$, $\sigma = 2$, $\mu = 1$}
    \label{fig:sphere_special1}
  \end{minipage}
  \begin{minipage}{0.48\textwidth}
    \centering
  \end{minipage}
\end{figure}